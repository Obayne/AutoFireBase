name: Open PR for chore/dev-setup-warnings

on:
  workflow_dispatch:
  push:
    branches:
      - chore/dev-setup-warnings

jobs:
  open-pr:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create or update PR
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const head = 'chore/dev-setup-warnings';
            const base = 'main';

            // Check if PR already exists
            const prs = await github.paginate(github.rest.pulls.list, { owner, repo, state: 'open', head: `${owner}:${head}` });
            if (prs.length > 0) {
              core.info(`PR already open: #${prs[0].number}`);
              core.setOutput('pr_number', prs[0].number);
              return;
            }

            const title = 'chore: dev setup warnings + Sprint 01 plan + issue templates';
            const body = [
              'This PR keeps main green and unblocks the team by:',
              '',
              '- Normalizing dev setup warnings punctuation in `setup_dev.ps1`',
              '- Adding Sprint 01 plan at `docs/SPRINT-01.md`',
              '- Adding issue templates under `.github/ISSUE_TEMPLATE/`',
              '- Adding workflows to seed Sprint issues and auto-open this PR',
              '',
              'Review focus:',
              '- Repo hygiene only; no runtime logic changed beyond script messages',
              '- Validate sprint plan structure and labels/templates',
              '',
              'Links:',
              '- Sprint Plan: docs/SPRINT-01.md'
            ].join('\n');

            const pr = await github.rest.pulls.create({ owner, repo, title, head, base, body, draft: false });
            core.info(`Opened PR #${pr.data.number}`);
            core.setOutput('pr_number', pr.data.number);

